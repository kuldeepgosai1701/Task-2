<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GPS Motion Tracker with Leaflet</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { height: 100%; font-family: 'Segoe UI', sans-serif; background: #e6f0ff; }

    header {
      background: #004080;
      color: #fff;
      text-align: center;
      padding: 15px;
      font-size: 1.6rem;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .sensitivity-box {
      position: fixed;
      top: 70px;
      right: 20px;
      background: rgba(0, 64, 128, 0.9);
      color: #fff;
      padding: 12px 16px;
      border-radius: 12px;
      z-index: 1001;
    }

    .sensitivity-box input[type="range"] {
      width: 150px;
    }

    .info {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 12px;
      z-index: 1001;
      width: 250px;
    }

    button {
      margin-top: 5px;
      padding: 8px 14px;
      font-size: 0.9rem;
      font-weight: 600;
      border: none;
      background: linear-gradient(120deg, #007bff, #0056b3);
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: linear-gradient(120deg, #0056b3, #003f8c);
    }

    #map {
      height: 100vh;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 0;
    }

    footer {
      background: linear-gradient(90deg, #004080, #0066cc);
      color: white;
      text-align: center;
      padding: 14px;
      font-size: 1rem;
      position: sticky;
      bottom: 0;
      z-index: 1000;
    }
  </style>
</head>
<body>

<header>
  Motion Tracker
  <button onclick="toggleHistory()" style="float: right; margin-right: 10px;">History</button>
</header>

<div class="sensitivity-box">
  <h3>Sensitivity</h3>
  <input type="range" id="sensitivityRange" min="0" max="10" step="1" value="5">
  <div>Value: <span id="sensVal">5</span></div>
</div>

<div class="info">
  <p>üìç Tracker Info</p>
  <p id="location">Location: Fetching...</p>
  <p id="direction">Direction: Calculating...</p>
  <button onclick="startTracking()">Start</button>
  <button onclick="stopTracking()">Stop</button>
  <button onclick="resetPage()">Reset</button>
  <button onclick="saveDataToFile()">Save</button>
</div>

<!-- Map container -->
<div id="map"></div>

<footer>Created by Kuldeep Gosai</footer>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  let prevLat = null, prevLon = null;
  let gpsHistory = [];
  let recordedData = [];
  let sensitivityFactor = 5;
  let vibratedRecently = false;
  let trackingInterval = null;

  const locationText = document.getElementById("location");
  const directionText = document.getElementById("direction");
  const sensitivityRange = document.getElementById("sensitivityRange");
  const sensVal = document.getElementById("sensVal");

  sensitivityRange.addEventListener("input", () => {
    sensitivityFactor = parseFloat(sensitivityRange.value);
    sensVal.textContent = sensitivityRange.value;
  });

  // Leaflet map setup
  let map = L.map('map').setView([0, 0], 18);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  let dotMarker = L.circleMarker([0, 0], {
    radius: 10,
    fillColor: "#007bff",
    color: "#003366",
    weight: 2,
    opacity: 1,
    fillOpacity: 0.9
  }).addTo(map);

  let pathCoords = [];
  let pathLine = L.polyline(pathCoords, { color: 'blue' }).addTo(map);

  function showLocation(position) {
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;
    locationText.textContent = `Location: ${lat.toFixed(5)}, ${lon.toFixed(5)}`;

    pathCoords.push([lat, lon]);
    pathLine.setLatLngs(pathCoords);
    dotMarker.setLatLng([lat, lon]);
    map.setView([lat, lon]);

    if (prevLat !== null && prevLon !== null) {
      const dx = lon - prevLon;
      const dy = lat - prevLat;
      const angle = Math.atan2(dy, dx) * (180 / Math.PI);
      directionText.textContent = `Direction: ${getDirectionFromAngle(angle)}`;
    }

    if (vibratedRecently) {
      L.circleMarker([lat, lon], {
        radius: 5,
        fillColor: "red",
        color: "darkred",
        weight: 1,
        opacity: 1,
        fillOpacity: 0.9
      }).addTo(map);
    }

    prevLat = lat;
    prevLon = lon;
  }

  function getDirectionFromAngle(angle) {
    const directions = ["East ‚Üí", "North-East ‚ÜóÔ∏è", "North ‚Üë", "North-West ‚ÜñÔ∏è",
                        "West ‚Üê", "South-West ‚ÜôÔ∏è", "South ‚Üì", "South-East ‚ÜòÔ∏è"];
    return directions[Math.round((angle % 360 + 360) % 360 / 45) % 8];
  }

  function showError(error) {
    console.error("GPS Error:", error);
    locationText.textContent = "Location: Error fetching";
  }

  // Vibration detection
  window.addEventListener('devicemotion', function(event) {
    if (!event.acceleration) return;

    const ax = event.acceleration.x || 0;
    const ay = event.acceleration.y || 0;
    const az = event.acceleration.z || 0;
    const totalAccel = Math.sqrt(ax * ax + ay * ay + az * az);
    const vibrationThreshold = 5 + (sensitivityFactor * 2.5);

    vibratedRecently = totalAccel > vibrationThreshold;

    if (vibratedRecently) {
      navigator.vibrate(300);
    }

    recordedData.push({
      x: ax,
      y: ay,
      z: az,
      vibration: vibratedRecently ? "Yes" : "No",
      direction: directionText.textContent.replace("Direction: ", "")
    });
  });

  function saveDataToFile() {
    const numberOfEntries = parseInt(sensitivityRange.value);
    const recentData = recordedData.slice(-numberOfEntries);
    if (recentData.length === 0) {
      alert("No data to save.");
      return;
    }
    let fileContent = "X\tY\tZ\tVibration\tDirection\n";
    recentData.forEach(entry => {
      fileContent += `${entry.x.toFixed(2)}\t${entry.y.toFixed(2)}\t${entry.z.toFixed(2)}\t${entry.vibration}\t${entry.direction}\n`;
    });
    const blob = new Blob([fileContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "motion_data.txt";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  function startTracking() {
    if (!trackingInterval) {
      trackingInterval = setInterval(() => {
        if ("geolocation" in navigator) {
          navigator.geolocation.getCurrentPosition(showLocation, showError);
        }
      }, 5000);
    }
  }

  function stopTracking() {
    clearInterval(trackingInterval);
    trackingInterval = null;
  }

  function resetPage() {
    location.reload();
  }
</script>

</body>
</html>













