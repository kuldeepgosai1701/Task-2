<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gyroscope Motion Tracker</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body, html {
      height: 100%;
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    header {
      background: #222;
      color: #fff;
      text-align: center;
      padding: 15px;
      font-size: 1.5rem;
    }

    main {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    .info {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255,255,255,0.95);
      padding: 10px;
      border-radius: 8px;
      z-index: 10;
    }

    button {
      margin-top: 5px;
      padding: 5px 12px;
      font-size: 0.9rem;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 4px;
    }

    #dot {
      width: 18px;
      height: 18px;
      background: blue;
      border-radius: 50%;
      position: absolute;
      z-index: 5;
    }

    .trail {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      position: absolute;
      z-index: 1;
      transition: all 0.3s ease;
    }

    footer {
      background: #ddd;
      text-align: center;
      padding: 10px;
      font-size: 0.9rem;
    }

    .compass {
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      margin-top: 10px;
      color: #333;
    }
  </style>
</head>
<body>

  <header>Motion Tracker</header>

  <main id="main">
    <div class="info">
      <p>Move your phone to see the motion path.</p>
      <p id="direction">Direction: Center</p>
      <p id="location">Location: Fetching...</p>
      <button onclick="resetData()">Reset</button>
      <button onclick="downloadGPSData()">Save GPS</button>
      <div class="compass">N</div>
    </div>

    <div id="dot"></div>

    <div style="position:absolute; bottom:0; width:100%; max-height:200px; overflow:auto; background:#fff;">
      <table id="data-table" border="1" style="width:100%; font-size:0.8rem; border-collapse:collapse;">
        <thead style="position:sticky; top:0; background:#007bff; color:white;">
          <tr>
            <th>Time</th>
            <th>X</th>
            <th>Y</th>
            <th>Z</th>
            <th>Direction</th>
            <th>Vibration</th>
            
          </tr>
        </thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>
  </main>

  <footer>Created by Kuldeep Gosai</footer>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

  <script>
    

    const firebaseConfig = {
      apiKey: "AIzaSyDh77dygGxVJMc8hRgm_ruQS_DW-vq_39M",
      authDomain: "gyroscope-explorer-1bafb.firebaseapp.com",
      databaseURL: "https://gyroscope-explorer-1bafb-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "gyroscope-explorer-1bafb",
      storageBucket: "gyroscope-explorer-1bafb.appspot.com",
      messagingSenderId: "471468344921",
      appId: "1:471468344921:web:2c944e8a3b5da71c401348"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentLatitude = null;
    let currentLongitude = null;
    let x = window.innerWidth / 2;
    let y = window.innerHeight / 2;

window.addEventListener("load", () => {
  // Wait till page fully loads
  moveDot(x, y);  // center me dot dikhe
});


    let gpsDataList = [];

    const dot = document.getElementById("dot");
    const main = document.getElementById("main");
    const directionText = document.getElementById("direction");
    const tableBody = document.getElementById("table-body");
    let lastSaveTime = 0; 
    let lastOrientationSaveTime = 0;
    let lastMotionSaveTime = 0;


    function moveDot(newX, newY, vibration = false) {
      dot.style.left = `${newX - dot.offsetWidth / 2}px`;
      dot.style.top = `${newY - dot.offsetHeight / 2}px`;

      const trail = document.createElement("div");
      trail.className = "trail";
      trail.style.left = `${newX - 1}px`;
      trail.style.top = `${newY - 1}px`;

      if (vibration) {
        trail.style.background = "red";
        trail.style.width = "10px";
        trail.style.height = "10px";
      } else {
        trail.style.background = "blue";
      }

      main.appendChild(trail);
    }

    function getDirection(gamma, beta) {
      let dir = "";
      if (beta > 5) dir += "South ";
      else if (beta < -5) dir += "North ";
      if (gamma > 5) dir += "East";
      else if (gamma < -5) dir += "West";
      return dir.trim() || "Center";
    }

    function updateDirection(gamma, beta) {
      directionText.textContent = `Direction: ${getDirection(gamma, beta)}`;
    }

    function saveToDatabase(x, y, z, direction, vibration) {
      const data = {
        axis: {
          x: x?.toFixed(2),
          y: y?.toFixed(2),
          z: z?.toFixed(2) ?? "N/A"
        },
        latitude: currentLatitude,
        longitude: currentLongitude,
        timestamp: new Date().toISOString(),
        direction,
        vibration
      };
      db.ref("motionData").push(data);
    }

    function resetData() {
      if (confirm("Are you sure you want to reset all motion data?")) {
        db.ref("motionData").remove().then(() => {
          alert("Data cleared successfully.");
          location.reload();
        });
      }
    }
function showLocation(position) {
  currentLatitude = position.coords.latitude.toFixed(5);
  currentLongitude = position.coords.longitude.toFixed(5);

  // Hide location from screen (if you want nothing visible)
  document.getElementById("location").textContent = `Location: (Hidden)`;

  // Save ONLY to file (keep storing)
  gpsDataList.push({
    latitude: currentLatitude,
    longitude: currentLongitude
  });
}


    function showError(error) {
      const locationText = document.getElementById("location");
      switch(error.code) {
        case error.PERMISSION_DENIED:
          locationText.textContent = "Location: Permission denied.";
          break;
        case error.POSITION_UNAVAILABLE:
          locationText.textContent = "Location: Not available.";
          break;
        case error.TIMEOUT:
          locationText.textContent = "Location: Timeout.";
          break;
        default:
          locationText.textContent = "Location: Unknown error.";
      }
    }

    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(showLocation, showError);
    } else {
      document.getElementById("location").textContent = "Location: Not supported.";
    }

      

    function handleOrientation(event) {
      const gamma = event.gamma;
      const beta = event.beta;
      const alpha = event.alpha;

      if (gamma !== null && beta !== null && alpha !== null) {
        x += gamma * 0.05;
        y += beta * 0.05;

        const dotSize = dot.offsetWidth;
        x = Math.max(0, Math.min(x, window.innerWidth - dotSize));
        y = Math.max(0, Math.min(y, window.innerHeight - dotSize));

        const direction = getDirection(gamma, beta);
        moveDot(x, y, false);
        updateDirection(gamma, beta);
          const now = Date.now();
if (now - lastOrientationSaveTime > 1000) {
  lastOrientationSaveTime = now;
  saveToDatabase(gamma, beta, alpha, direction, false);
}

      }
    }

    window.addEventListener("load", () => {
      moveDot(x, y);
      if (typeof DeviceOrientationEvent?.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission().then(state => {
          if (state === "granted") {
            window.addEventListener("deviceorientation", handleOrientation);
            window.addEventListener("devicemotion", handleMotion);
          }
        }).catch(console.error);
      } else {
        window.addEventListener("deviceorientation", handleOrientation);
         window.addEventListener("devicemotion", handleMotion); // ADD THIS
      }
    });

    function detectVibration(x, y, z=0) {
      return Math.abs(x) > 10 || Math.abs(y) >10 Math.abs(z) > 10 ;
    }

    window.addEventListener("devicemotion", (event) => {
      const acc = event.acceleration;
      if (acc?.x !== null && acc?.y !== null) {
        const vibrate = detectVibration(acc.x, acc.y acc.z ?? 0);

         // ðŸ”¥ Step 3: Add this logging for debugging
        if (vibrate) {
       console.log("ðŸ’¥ Vibration Detected!", {
        x: acc.x.toFixed(2),
        y: acc.y.toFixed(2),
        z: acc.z?.toFixed(2) ?? "N/A"
      });
    }
        x += acc.x * 2;
        y += acc.y * 2;

        const dotSize = dot.offsetWidth;
        x = Math.max(0, Math.min(x, window.innerWidth - dotSize));
        y = Math.max(0, Math.min(y, window.innerHeight - dotSize));

        moveDot(x, y, vibrate);
         const now = Date.now();
if (now - lastMotionSaveTime > 1000) {
  lastMotionSaveTime = now;
  saveToDatabase(acc.x, acc.y, acc.z ?? 0, "N/A", vibrate);
}


      }
    });

    db.ref("motionData").limitToLast(30).on("child_added", (snapshot) => {
      const data = snapshot.val();
      const row = document.createElement("tr");

      if (data.vibration) {
        row.style.background = "#ffe5e5";
      }

      row.innerHTML = `
        <td>${new Date(data.timestamp).toLocaleTimeString()}</td>
        <td>${data.axis.x}</td>
        <td>${data.axis.y}</td>
        <td>${data.axis.z ?? "N/A"}</td>
        <td>${data.direction}</td>
        <td>${data.vibration ? "ðŸ’¥ Yes" : "âœ… No"}</td>
       
      `;

      tableBody.insertBefore(row, tableBody.firstChild);
    });
     function downloadGPSData() {
  if (gpsDataList.length === 0) {
    alert("No GPS data to download.");
    return;
  }

  const blob = new Blob([JSON.stringify(gpsDataList, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "gps_data.json";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);

  URL.revokeObjectURL(url);
}

  </script>
</body>
</html>















